var app=app||{},BASE_URL=BASE_URL||"http://localhost:8080/";app.UserModel=Backbone.Model.extend({}),app.CarMakerModel=Backbone.Model.extend({initialize:function(a,b){this.path=b.path},url:function(){return BASE_URL+this.path}}),app.CarModel=Backbone.Model.extend({defaults:{available:"true",owner:authUserUsername},initialize:function(a,b){this.path=b.path},url:function(){return BASE_URL+this.path}}),app.PurchaseModel=Backbone.Model.extend({initialize:function(a,b){this.path=b.path},url:function(){return BASE_URL+this.path}});var app=app||{},BASE_URL=BASE_URL||"http://localhost:8080/";app.CarMakersCollection=Backbone.Collection.extend({model:app.CarMakerModel,url:BASE_URL+"car-maker/"}),app.CarsCollection=Backbone.PageableCollection.extend({model:app.CarModel,initialize:function(a,b){this.path=b.path},url:function(){return BASE_URL+this.path},mode:"client",state:{pageSize:5}}),app.PurchasesCollection=Backbone.Collection.extend({model:app.PurchaseModel,initialize:function(a,b){this.path=b.path},url:function(){return BASE_URL+this.path}}),app.UsersCollection=Backbone.Collection.extend({model:app.UserModel,url:BASE_URL+"users/"});var app=app||{};app.MainAppView=Backbone.View.extend({template:_.template($("#carMakersTemplate").html()),render:function(){var a=this.collection.models;this.$el.html(this.template({data:a}))},initialize:function(){$(".jumbotron").text("Welcome to this awesome car web shop!");var a=this;this.collection.fetch({success:function(){console.log("Success! CarMakers fetched."),a.render()},error:function(){console.log("Error! Car makers couldn't be fetched.")}})}}),app.ChosenCarMakerView=Backbone.View.extend({template:_.template($("#carsTemplate").html()),events:{"click #previousCarListButton":"previousCarPage","click #nextCarListButton":"nextCarPage"},nextCarPage:function(){var a=this.collection.state.lastPage,b=this.collection.state.currentPage;b==a?alert("Last page!"):(this.collection.getNextPage(),this.render())},previousCarPage:function(){var a=this.collection.state.firstPage,b=this.collection.state.currentPage;b==a?alert("First page!"):(this.collection.getPreviousPage(),this.render())},render:function(){var a=this.collection.state.firstPage,b=this.collection.state.lastPage,c=this.collection.state.currentPage,d="";c==a?d="first":c==b&&(d="last");var e=this.collection.models;this.$el.html(this.template({data:e,flag:d})),c==a&&c==b&&$(".car-list-buttons").hide()},initialize:function(){$(".jumbotron").text("Welcome to this awesome car web shop!");var a=this;this.collection.fetch({success:function(){console.log("Success! Cars fetched."),a.render()},error:function(){console.log("Error in ChosenCarMakerView! Cars couldn't be fetched.")}})}}),app.ChosenCarView=Backbone.View.extend({template:_.template($("#carDetailsTemplate").html()),events:{"click #purchase-car":"purchaseCar"},render:function(){var a=this,b=this.model.attributes,c=new app.CarMakerModel([],{path:"car-maker/?id="+b.maker});c.fetch({success:function(){a.$el.html(a.template({data:b,carMaker:c.attributes[0]}))},error:function(){console.log("Error in ChosenCarView! CarMaker couldn't be fetched.")}})},initialize:function(){$(".jumbotron").text("Car details");var a=this;this.model.fetch({success:function(){console.log("Success! Car fetched."),a.render()},error:function(){console.log("Error in ChosenCarView! Car couldn't be fetched.")}})},purchaseCar:function(){var a=$("#cardNumberInput").val();if(""==a)alert("Please enter your card number!");else{var b=this,c=$("#purchase-car").attr("data-car-id"),d=$("#priceForPurchase").text(),e=$("#discountForPurchase").text(),f=d-d*e/100,g=new app.PurchaseModel([],{path:"purchase/"});g.set({car:c,credit_card_number:a,price_paid:f}),console.log(g),g.save({},{success:function(){console.log("Purchase saved!"),b.unbind(),b.remove(),$(".modal-backdrop").remove(),$(".modal-open").removeAttr("style"),$(".modal-open").removeClass("modal-open"),window.location=BASE_URL+"web-shop/#my-purchases"},error:function(){console.log("Error saving purchase in ChosenCarView!")}})}}}),app.CurrentUserCars=Backbone.View.extend({template:_.template($("#carsTemplate").html()),events:{"click #previousCarListButton":"previousCarPage","click #nextCarListButton":"nextCarPage"},nextCarPage:function(){var a=this.collection.state.lastPage,b=this.collection.state.currentPage;b==a?alert("Last page!"):(this.collection.getNextPage(),this.render())},previousCarPage:function(){var a=this.collection.state.firstPage,b=this.collection.state.currentPage;b==a?alert("First page!"):(this.collection.getPreviousPage(),this.render())},render:function(){var a=this.collection.state.firstPage,b=this.collection.state.lastPage,c=this.collection.state.currentPage,d="";c==a?d="first":c==b&&(d="last");var e=this.collection.models;this.$el.html(this.template({data:e,flag:d}))},initialize:function(){$(".jumbotron").text("My cars");var a=this;this.collection.fetch({success:function(){console.log("Success! Cars fetched."),a.render()},error:function(){console.log("Error in CurrentUserCars! Cars couldn't be fetched.")}})}}),app.CurrentUserPurchases=Backbone.View.extend({el:$("#content"),template:_.template($("#userPurchasesTemplate").html()),render:function(){var a=this.collection.models;this.$el.html(this.template({data:a}))},initialize:function(){$(".jumbotron").text("My purchases");var a=this;this.collection.fetch({success:function(){console.log("Success! Cars fetched."),a.render()},error:function(){console.log("Error in CurrentUserCars! Cars couldn't be fetched.")}})}}),app.AddNewCar=Backbone.View.extend({template:_.template($("#addNewCarTemplate").html()),render:function(){var a=new app.CarModel([],{}),b=a.attributes,c=this,d=new app.CarMakerModel([],{path:"car-maker/"});d.fetch({success:function(){return c.$el.html(c.template({data:b,carMakers:d.attributes.results})),c},error:function(){console.log("Error in AddNewCar! CarMakers couldn't be fetched.")}})},initialize:function(){$(".jumbotron").text("Fill the fields with your car information"),this.render()},events:{"click #new-car-button":"saveCar"},saveCar:function(){var a=this,b=new app.CarModel([],{path:"cars/"});this.setValuesToNewCar(b),b.save({},{success:function(b,c,d){alert("The model has been saved to the server"),a.unbind(),a.remove(),window.location=BASE_URL+"web-shop/#my-cars"},error:function(a,b,c){alert("Error while saving car! More info in console."),console.log(b.responseText)}})},setValuesToNewCar:function(a){var b=$("#maker option:selected").attr("value"),c=$("#model").val(),d=$("#location").val(),e=$("#fuel_type option:selected").attr("value"),f=$("#mileage").val(),g=$("#price").val(),h=$("#manufacturing_year option:selected").attr("value"),i=$("#discount").val();a.set({maker:b,model:c,location:d,fuel_type:e,mileage:f,price:g,manufacturing_year:h,discount:i})}}),app.UpdateCarInfo=Backbone.View.extend({template:_.template($("#carUpdateTemplate").html()),events:{"click #update-car-button":"updateCar"},initialize:function(){$(".jumbotron").text("Update the fields with your new car information");var a=this;this.model.fetch({success:function(){a.render()},error:function(){console.log("Error in UpdateCarInfo! Model couldn't be fetched.")}})},render:function(){var a=this;this.$el.html(a.template({data:a.model.attributes}))},updateCar:function(){var a=$("#upd-model").val(),b=$("#upd-location").val(),c=$("#upd-fuel_type option:selected").attr("value"),d=$("#upd-mileage").val(),e=$("#upd-price").val(),f=$("#upd-manufacturing_year option:selected").attr("value"),g=$("#upd-discount").val();this.model.set({model:a,location:b,fuel_type:c,mileage:d,price:e,manufacturing_year:f,discount:g});var h=this;this.model.save({},{success:function(a,b,c){alert("The model has been saved to the server"),h.unbind(),h.remove(),window.location=BASE_URL+"web-shop/#my-cars"},error:function(a,b,c){alert("Error while saving car! More info in console."),console.log(b.responseText)}})}});var app=app||{};app.MainRouter=Backbone.Router.extend({routes:{"":"mainPage","car-maker/:id":"showCars","cars/:id":"showCarDetails","my-cars":"showMyCars","my-purchases":"showMyPurchases","add-car":"addNewCar","delete-car/:id":"deleteCar","edit-car/:id":"editCar"},resetTemplate:function(){$("#main-content").html('<h1 class="jumbotron"></h1><section id="content" class="container"></section>')},mainPage:function(){this.resetTemplate();var a=new app.CarMakersCollection;new app.MainAppView({collection:a,el:$("#content")})},showCars:function(a){this.resetTemplate(),a="0"===a?"":a;var b=new app.CarsCollection([],{path:"cars/?maker="+a});new app.ChosenCarMakerView({collection:b,el:$("#content")})},showCarDetails:function(a){this.resetTemplate();var b=new app.CarModel([],{path:"cars/"+a+"/"});new app.ChosenCarView({model:b,el:$("#content")})},showMyCars:function(){this.resetTemplate();var a=new app.CarsCollection([],{path:"cars/?owner="+authUserId});new app.CurrentUserCars({collection:a,el:$("#content")})},showMyPurchases:function(){this.resetTemplate();var a=new app.PurchasesCollection([],{path:"purchase/?user="+authUserId});new app.CurrentUserPurchases({collection:a,el:$("#content")})},addNewCar:function(){this.resetTemplate(),new app.AddNewCar({el:$("#content")})},deleteCar:function(a){var b=new app.CarModel({id:a},{path:"cars/"+a+"/"});b.destroy({success:function(){alert("Car successfully deleted!"),window.location=BASE_URL+"web-shop/#my-cars"},error:function(){alert("Failed to delete car!")}})},editCar:function(a){this.resetTemplate();var b=new app.CarModel({id:a},{path:"cars/"+a+"/"});new app.UpdateCarInfo({model:b,el:$("#content")})}});var mainRouter=new app.MainRouter;Backbone.history.start(),$(function(){function a(a){var b=null;if(document.cookie&&""!=document.cookie)for(var c=document.cookie.split(";"),d=0;d<c.length;d++){var e=jQuery.trim(c[d]);if(e.substring(0,a.length+1)==a+"="){b=decodeURIComponent(e.substring(a.length+1));break}}return b}function b(a){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(a)}console.log("Start of script!");var c=a("csrftoken");$.ajaxSetup({beforeSend:function(a,d){b(d.type)||this.crossDomain||a.setRequestHeader("X-CSRFToken",c)}})});